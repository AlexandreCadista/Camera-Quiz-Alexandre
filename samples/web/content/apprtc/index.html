<!DOCTYPE html>
<!--
 *  Copyright (c) 2014 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
-->
<html>

<head>

  <title>WebRTC Reference App</title>

  <meta charset="utf-8">
  <meta name="description" content="WebRTC reference app">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  {{ meta_viewport }}

  <link rel="canonical" href="{{ room_link }}">
  <link rel="stylesheet" href="css/main.css">

  <!-- External dependencies. -->
  <script type="text/javascript" src="/_ah/channel/jsapi" defer></script>
  <!-- Load the polyfill to switch-hit between Chrome and Firefox -->
  <script src="/js/adapter.js" defer></script>
  {{ include_vr_js }}

  <!-- Application includes. Changing order may break application. -->
  <script type="text/javascript" defer>
    var config = {
      errorMessages: {{ error_messages }},
      channelToken: '{{ token }}',

      roomId: '{{ room_key }}',
      roomLink: '{{ room_link }}',
      clientId: '{{ me }}',
      isInitiator: {{ initiator }},

      turnUrl: '{{ turn_url }}',
      peerConnectionConfig: {{ pc_config | safe }},
      peerConnectionConstraints: {{ pc_constraints | safe }},
      offerConstraints: {{ offer_constraints | safe }},
      mediaConstraints: {{ media_constraints | safe }},

      stereo: {{ stereo }},
      opusfec: {{ opusfec }},
      opusMaxPbr: '{{ opusmaxpbr }}',
      audioSendBitrate: '{{ asbr }}',
      audioRecvBitrate: '{{ arbr }}',
      videoSendBitrate: '{{ vsbr }}',
      videoRecvBitrate: '{{ vrbr }}',
      videoSendInitialBitrate: '{{ vsibr }}',
      stereoscopic: '{{ ssr }}',
      audioSendCodec: '{{ audio_send_codec }}',
      audioRecvCodec: '{{ audio_receive_codec }}',
    };

    var app = null;
    document.addEventListener('DOMContentLoaded', function() {
      app = new apprtc.App();
    });

    window.addEventListener('beforeunload', function() {
      app.shutdown();
      app = null;
    });
  </script>
  <script src="/js/pubsub.js" defer></script>
  <script src="/js/perf.js" defer></script>
  <script src="/js/logging.js" defer></script>
  <script src="/js/util.js" defer></script>
  <script src="/js/signaling.js" defer></script>
  <script src="/js/stats.js" defer></script>
  <script src="/js/infobox.js" defer></script>
  <script src="/js/apprtc.js" defer></script>

</head>

<body>

<div id="container">
  <div id="card">
    <div id="local">
      <video id="localVideo" autoplay="autoplay" muted></video>
    </div>
    <div id="remote">
      <!-- Remote video is displayed in the canvas below when stereoscopic
          rendering is requested (&ssr=true). -->
      <canvas id="remoteCanvas" style="display: none;"></canvas>
      <video id="remoteVideo" autoplay="autoplay"></video>
      <div id="mini">
        <video id="miniVideo" autoplay="autoplay" muted></video>
      </div>
    </div>
  </div>
</div>

<footer id="status"></footer>

<div id="infoDiv"></div>

</body>
</html>
